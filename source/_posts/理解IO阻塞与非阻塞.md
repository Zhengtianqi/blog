title: 理解IO阻塞与非阻塞
author: 郑天祺
tags:
  - IO
  - 阻塞与非阻塞
categories:
  - 网络
date: 2019-08-30 17:34:00

---

## 1、饭店吃饭的例子

A君喜欢下馆子吃饭，服务员点完餐后，A君一直坐在座位上等待厨师炒菜，什么事情也没有干，过了一会服务员端上饭菜后，A君就开吃了 -- 【阻塞I/O】

B君也喜欢下馆子，服务员点完餐后，B君看这个服务员长得不错便前去搭讪，一直和服务员聊人生理想，并时不时的打听自己的饭做好了没有，过了一会饭也做好了，B君也撩到了美女服务员的微信号 -- 【非阻塞I/O 】  

## 2、阻塞与非阻塞调用对比

![](/img/阻塞与非阻塞调用对比.png)

## 3、阻塞IO

![](/img/阻塞IO.png)

## 4、非阻塞IO

![](/img/非阻塞IO.png)

## 5、I/O复用模型

​	前面讲的非阻塞仍然需要进程不断的轮询重试。能不能实现当数据可读了以后给程序一个通知呢？所以这里引入了一个IO多路复用模型，I/O多路复用的本质是通过一种机制（系统内核缓冲I/O数据），让单个进程可以监视多个文件描述符，一旦某个描述符就绪（一般是读就绪或写就绪），能够通知程序进行相应的读写操作。

​	常见的IO多路复用方式有【select、poll、epoll】，都是Linux  API提供的IO复用方式

## 6、I/O复用select模型

![](/img/IO复用select模型.png)

## 7、select、epoll模型对比

![](/img/select、epoll模型对比.png)

这个模式有二个缺点
1. 由于他能够同时监听多个文件描述符，假如说有1000个，这个时候如果其中一个fd 处于就绪状态了，那么当前进程需要线性轮询所有的fd，也就是监听的fd越多，性能开销越大。
2. 同时，select在单个进程中能打开的fd是有限制的，默认是1024，对于那些需要支持单机上万的TCP连接来说确实有点少。

## 8、多路复用的好处

I/O多路复用可以通过把多个I/O的阻塞复用到同一个select的阻塞上，从而使得系统在单线程的情况下可以同时处理多个客户端请求。它的最大优势是系统开销小，并且不需要创建新的进程或者线程，降低了系统的资源开销